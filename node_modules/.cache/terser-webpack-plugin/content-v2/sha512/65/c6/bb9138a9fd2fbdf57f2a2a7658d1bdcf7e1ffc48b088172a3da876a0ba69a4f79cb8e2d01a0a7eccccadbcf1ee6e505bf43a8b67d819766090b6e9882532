{"code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t,n){\"use strict\";n.r(t);class r{constructor(e,t){this.api=t,this.data=e,this.cardElement=this.create(this.data)}create(e){const t=`\\n      <div class=\"place-card__image\" style=\"background-image: url('${e.link}');\">\\n        <button class=\"place-card__delete-icon\"></button>\\n        </div><div class=\"place-card__description\">\\n        <h3 class=\"place-card__name\">${e.name}</h3>\\n        <div class=\"place-card__like-container\">\\n          <button class=\"place-card__like-icon\"></button>\\n          <p class=\"place-card__like-count\"></p>\\n        </div>\\n      </div>`,n=document.createElement(\"div\");n.classList.add(\"place-card\"),n.setAttribute(\"data-card-id\",`${e._id}`),n.innerHTML=t;const r=n.querySelector(\".place-card__like-count\");n.querySelector(\".place-card__like-icon\").addEventListener(\"click\",e=>s.pushLike(e)),n.querySelector(\".place-card__delete-icon\").addEventListener(\"click\",e=>s.removeCard(e)),n.querySelector(\".place-card__image\").addEventListener(\"click\",e=>i.open(e));const o=s.isLiked(e);return n.setAttribute(\"data-liked\",o.status),o.status?n.querySelector(\".place-card__like-icon\").classList.add(\"place-card__like-icon_liked\"):n.querySelector(\".place-card__like-icon\").classList.remove(\"place-card__like-icon_liked\"),e.likes.length>99?r.textContent=\"99+\":r.textContent=e.likes.length,e.owner._id!==this.api.userId&&n.querySelector(\".place-card__image\").removeChild(n.querySelector(\".place-card__delete-icon\")),n}}const o=new class{constructor(e){this.url=e.url,this.token=e.token,this.userId=\"\"}getUserData(){return fetch(`${this.url}/users/me`,{headers:{authorization:this.token}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}patchUserData(e){return fetch(`${this.url}/users/me`,{method:\"PATCH\",headers:{authorization:this.token,\"Content-Type\":\"application/json\"},body:JSON.stringify(e)}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}patchUserPic(e){return fetch(`${this.url}/users/me/avatar`,{method:\"PATCH\",headers:{authorization:this.token,\"Content-Type\":\"application/json\"},body:JSON.stringify(e)}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}getCardList(){return fetch(`${this.url}/cards`,{headers:{authorization:this.token}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}postNewCard(e){return fetch(`${this.url}/cards`,{method:\"POST\",headers:{authorization:this.token,\"Content-Type\":\"application/json\"},body:JSON.stringify(e)}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}deleteCard(e){return fetch(`${this.url}/cards/${e}`,{method:\"DELETE\",headers:{authorization:this.token,\"Content-Type\":\"application/json\"}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}like(e,t){return fetch(`${this.url}/cards/like/${e}`,{method:t,headers:{authorization:this.token,\"Content-Type\":\"application/json\"}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}delLike(e){return fetch(`${this.url}/cards/like/${e}`,{method:\"DELETE\",headers:{authorization:this.token,\"Content-Type\":\"application/json\"}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}fetchLike(e,t){return fetch(`${this.url}/cards/like/${e}`,{method:t,headers:{authorization:this.token,\"Content-Type\":\"application/json\"}}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}}({url:\"http://95.216.175.5/cohort4\",token:\"01ae8842-bd3d-421f-aca3-5f8ed5caf81a\"}),a=new class{constructor(e){this.api=e}load(){this.api.getUserData().then(e=>{this.api.userId=e._id,this.render(e)})}changeNameAbout(e){this.api.patchUserData(e).then(e=>{this.render(e)})}render(e){document.querySelector(\".user-info__name\").textContent=e.name,document.querySelector(\".user-info__job\").textContent=e.about,document.querySelector(\".user-info__photo\").style.backgroundImage=`url(${e.avatar})`}changeUserPic(e){this.api.patchUserPic(e).then(e=>{console.log(e),this.render(e)})}}(o),s=new class{constructor(e,t){this.api=t,this.container=e,this.cardsData=[]}render(){this.api.getCardList().then(e=>{for(let t=e.length-1;0<=t;t--){this.cardsData.unshift(e[t]);const{cardElement:n}=new r(e[t],this.api);this.container.appendChild(n)}})}addCard(e){const t={name:e.name,link:e.link};this.api.postNewCard(t).then(e=>{const{cardElement:t}=new r(e,this.api);this.container.insertBefore(t,this.container.firstChild),this.cardsData.unshift(e)})}removeCard(e){e.stopPropagation();const t=e.target.closest(\".place-card\").dataset.cardId;console.log(t),this.api.deleteCard(t).then(n=>{\"Пост удалён\"===n.message&&(e.target.closest(\".place-card\").remove(),this.cardsData=this.cardsData.filter((function(e){if(e._id!==t)return e})))})}pushLike(e){e.stopPropagation();let t=e.target.closest(\".place-card\").dataset.liked;const n=e.target.closest(\".place-card\").dataset.cardId;let r=\"string\";r=\"true\"===t?\"DELETE\":\"PUT\",this.api.like(n,r).then(n=>{const r=e.target.closest(\".place-card\"),o=r.querySelector(\".place-card__like-count\"),a=r.querySelector(\".place-card__like-icon\"),s=this.isLiked(n);t=s.status,r.dataset.liked=s.status,s.status?(this.cardsData[s.number]=n,a.classList.add(\"place-card__like-icon_liked\")):a.classList.remove(\"place-card__like-icon_liked\"),n.likes.length>99?o.textContent=\"99+\":o.textContent=n.likes.length})}isLiked(e){let t=0;for(let n=0;n<=this.cardsData.length-1;n++)if(this.cardsData[n]._id===e._id){t=n;for(let n=e.likes.length-1;n>=0;n--)if(e.likes[n]._id===this.api.userId)return{status:!0,number:t};break}return{status:!1,number:t}}}(document.querySelector(\".places-list\"),o),i=new class{constructor(e,t){this.api=t,this.popupContainer=e}create(e){const t=document.createElement(\"div\");if(e.target.classList.contains(\"place-card__image\")){const n=`\\n        <img class=\"popup__pic\" src=\"${e.target.style.backgroundImage.slice(5,-2)}\">\\n        <img class=\"popup__close\" src=\"./images/close.svg\">`;return t.classList.add(\"popup__photo-content\"),t.innerHTML=n,t.querySelector(\".popup__close\").addEventListener(\"click\",()=>{this.close()}),t}if(e.target.classList.contains(\"user-info__add-button\")){const e='\\n        <img class=\"popup__close\" src=\"./images/close.svg\">\\n        <h3 class=\"popup__title\">Новое место</h3>\\n        <form class=\"popup__form form\">\\n          <input class=\"popup__input popup__input_type-name\" type=\"text\" name=\"name\" minlength=\"2\" maxlength=\"30\" required=\"yes\" placeholder=\"Название\">\\n          <span class=\"error error_hidden error__name\">its no errors</span>\\n          <input class=\"popup__input popup__input_type-additional\" type=\"url\" name=\"additional\" required=\"yes\" placeholder=\"Ссылка на фотографию\">\\n          <span class=\"error error_hidden error__additional\">its no errors</span>\\n          <button class=\"button popup__button\" disabled=\"yes\" name=\"button\" style=\"cursor: default;\">+</button>\\n        </form>';return t.classList.add(\"popup__content\"),t.innerHTML=e,t.querySelector(\".popup__close\").addEventListener(\"click\",()=>{this.close()}),t.querySelector(\".popup__input_type-name\").addEventListener(\"input\",e=>{this.validate(e,t.querySelector(\".popup__input_type-additional\"))}),t.querySelector(\".popup__input_type-additional\").addEventListener(\"input\",e=>{this.validate(e,t.querySelector(\".popup__input_type-name\"))}),t.querySelector(\".popup__button\").addEventListener(\"click\",e=>{e.preventDefault();const n={name:t.querySelector(\".popup__input_type-name\").value,link:t.querySelector(\".popup__input_type-additional\").value,count:0};s.addCard(n),this.close()}),t}if(e.target.classList.contains(\"user-info__edit-button\")){const e=`\\n        <img class=\"popup__close\" src=\"./images/close.svg\">\\n        <h3 class=\"popup__title\">Редактировать профиль</h3>\\n        <form class=\"popup__form form\">\\n          <input class=\"popup__input popup__input_type-name\" type=\"text\" name=\"name\" minlength=\"2\" maxlength=\"30\" required=\"yes\" placeholder=\"Имя\" value=\"${document.querySelector(\".user-info__name\").innerText}\">\\n          <span class=\"error error_hidden error__name\">its no errors</span>\\n          <input class=\"popup__input popup__input_type-additional\" type=\"text\" name=\"additional\" minlength=\"2\" maxlength=\"30\" required=\"yes\" placeholder=\"О Себе\" value=\"${document.querySelector(\".user-info__job\").innerText}\">\\n          <span class=\"error error_hidden error__additional\">its no errors</span>\\n          <button class=\"button popup__button\" disabled=\"yes\" name=\"button\" style=\"cursor: default; font-size: 18px; font-weight: bold;\">Сохранить</button>\\n        </form>`;return t.classList.add(\"popup__content\"),t.innerHTML=e,t.querySelector(\".popup__close\").addEventListener(\"click\",()=>{this.close()}),t.querySelector(\".popup__input_type-name\").addEventListener(\"input\",e=>{this.validate(e,t.querySelector(\".popup__input_type-additional\"))}),t.querySelector(\".popup__input_type-additional\").addEventListener(\"input\",e=>{this.validate(e,t.querySelector(\".popup__input_type-name\"))}),t.querySelector(\".popup__button\").addEventListener(\"click\",e=>{e.preventDefault(),this.close(),a.changeNameAbout({name:t.querySelector(\".popup__input_type-name\").value,about:t.querySelector(\".popup__input_type-additional\").value})}),t}if(e.target.classList.contains(\"user-info__photo\")){const e='\\n        <img class=\"popup__close\" src=\"./images/close.svg\">\\n        <h3 class=\"popup__title\">Обновить фотографию</h3>\\n        <form class=\"popup__form form\">\\n          <input class=\"popup__input popup__input_type-additional\" type=\"url\" name=\"additional\" required=\"yes\" placeholder=\"Ссылка на фотографию\">\\n          <span class=\"error error_hidden error__additional\">its no errors</span>\\n          <button class=\"button popup__button\" disabled=\"yes\" name=\"button\" style=\"cursor: default; font-size: 18px; font-weight: bold;\">Сохранить</button>\\n        </form>';return t.classList.add(\"popup__content\"),t.innerHTML=e,t.querySelector(\".popup__close\").addEventListener(\"click\",()=>{this.close()}),t.querySelector(\".popup__input_type-additional\").addEventListener(\"input\",e=>{this.validateInput(e)}),t.querySelector(\".popup__button\").addEventListener(\"click\",e=>{e.preventDefault(),a.changeUserPic({avatar:t.querySelector(\".popup__input_type-additional\").value}),this.close()}),t}}open(e){this.popupContainer.appendChild(this.create(e)),this.popupContainer.classList.toggle(\"is-opened\"),document.body.classList.add(\"body-fixed\")}close(){this.popupContainer.classList.toggle(\"is-opened\"),this.popupContainer.innerHTML=\"\",document.body.classList.remove(\"body-fixed\")}validate(e,t){const n=document.querySelector(\".popup__button\"),r=document.querySelector(`.error__${e.target.name}`),o=t.validity.valid;e.target.validity.valid&&o?(r.classList.add(\"error_hidden\"),r.textContent=\"no errors\",n.removeAttribute(\"disabled\"),n.style.backgroundColor=\"black\",n.style.color=\"white\",n.style.cursor=\"pointer\"):(r.textContent=e.target.validationMessage,r.classList.remove(\"error_hidden\"),n.setAttribute(\"disabled\",\"yes\"),n.style.backgroundColor=\"white\",n.style.color=\"rgba(0, 0, 0, .2)\",n.style.cursor=\"default\")}validateInput(e){const t=document.querySelector(\".popup__button\"),n=document.querySelector(`.error__${e.target.name}`);e.target.validity.valid?(n.classList.add(\"error_hidden\"),n.textContent=\"no errors\",t.removeAttribute(\"disabled\"),t.style.backgroundColor=\"black\",t.style.color=\"white\",t.style.cursor=\"pointer\"):(n.textContent=e.target.validationMessage,n.classList.remove(\"error_hidden\"),t.setAttribute(\"disabled\",\"yes\"),t.style.backgroundColor=\"white\",t.style.color=\"rgba(0, 0, 0, .2)\",t.style.cursor=\"default\")}}(document.querySelector(\".popup\"),o),c=document.querySelector(\".user-info__edit-button\"),l=document.querySelector(\".user-info__add-button\"),p=document.querySelector(\".user-info__photo\");a.load(),s.render(),c.addEventListener(\"click\",e=>i.open(e)),l.addEventListener(\"click\",e=>i.open(e)),p.addEventListener(\"click\",e=>i.open(e))}]);","extractedComments":[]}